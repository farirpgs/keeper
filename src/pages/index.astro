---
import { LogoSrc } from "../components/server/Header/Logo";
import { DLAstro } from "../domains/dl/DLAstro";
import { shuffleWithSeed } from "../domains/dl/shuffleWithSeed";
import Layout from "../layouts/Layout.astro";
import { HomeRoute } from "../routes/HomeRoute/HomeRoute";

const currentDateOfTheMonth = new Date().getDate();

const { games } = await DLAstro.getAllGamesWithCreator({});
const shuffledGames = shuffleWithSeed(games, currentDateOfTheMonth);
const sortedGame = shuffledGames.sort((a, b) => {
  return b.game.data.weight - a.game.data.weight;
});
const topGames = sortedGame.slice(0, 9);
// for (const game of topGames) {
//   if (game.game.data.image) {
//     console.log("ASDASASD", {
//       imageSrc: game.game.data.image,
//       importmetaurl: import.meta.url,
//       url: new URL(game.game.data.image, import.meta.url).toString(),
//     });

//     game.game.data.image = (await getImage({
//       src: new URL(game.game.data.image, import.meta.url).toString(),

//       format: "webp",
//     })) as any;
//     console.log(game.game.data.image);
//   }
// }

const { resources } = await DLAstro.getAllResourcesWithCreator({});
const shuffledResources = shuffleWithSeed(resources, currentDateOfTheMonth);
const sortedResources = shuffledResources.sort((a, b) => {
  return b.resource.data.weight - a.resource.data.weight;
});
const topResources = sortedResources.slice(0, 9);
// for (const resource of topResources) {
//   if (resource.resource.data.image) {
//     resource.resource.data.image = (await getImage({
//       src: new URL(
//         resource.resource.data.image.src,
//         import.meta.url
//       ).toString(),
//       format: "webp",
//     })) as any;
//   }
// }

const logoSrc = LogoSrc.src;
---

<Layout withOgImage title={undefined} description={undefined} withDefaultBanner>
  <HomeRoute
    client:load
    logo={logoSrc}
    topGames={topGames}
    topResources={topResources}
  />
</Layout>
