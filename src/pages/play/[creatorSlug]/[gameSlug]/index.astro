---
import type {
  GetStaticPathsItem,
  InferGetStaticParamsType,
  InferGetStaticPropsType,
} from "astro";
import Banner from "../../../../components/server/Banner/Banner.astro";
import { DL } from "../../../../domains/DL";
import { getTheme } from "../../../../domains/getTheme";
import Layout from "../../../../layouts/Layout.astro";
import { PlayPage } from "./_index";

export type Params = InferGetStaticParamsType<typeof getStaticPaths>;
export type Props = InferGetStaticPropsType<typeof getStaticPaths>;

const props = Astro.props as Props;
const params = Astro.params as Params;

export type SheetsType = typeof props.sheets;
export type SheetType = (typeof props.sheets)[number];

export async function getStaticPaths() {
  const gamesWithCreatorsAndSheets =
    await DL.getAllGamesWithCreatorsAndSheets();
  return gamesWithCreatorsAndSheets.map((item) => {
    return {
      params: {
        creatorSlug: item.creator.slug,
        gameSlug: item.game.slug.split("/").pop(),
      },
      props: {
        game: item.game,
        creator: item.creator,
        sheets: item.sheets,
      },
    } satisfies GetStaticPathsItem;
  });
}

const theme = getTheme({
  theme: {
    accentColor: props.game.data.theme?.accentColor,
  },
});
---

<Layout
  headingFont={props.game.data.theme?.headingFont}
  bodyFont={props.game.data.theme?.bodyFont}
>
  {
    props.game.data.image && (
      <Banner
        src={props.game.data.image}
        alt={props.game.data.name}
        justBackground
      />
    )
  }

  <PlayPage
    client:load
    game={props.game}
    creator={props.creator}
    sheets={props.sheets}
    theme={theme}
  />
</Layout>
